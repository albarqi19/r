<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุญุต ุงูุจูุงูุงุช ุงูุญููููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-center mb-4 text-blue-900">๐ ูุญุต ุงูุจูุงูุงุช ุงูุญููููุฉ</h1>
            <p class="text-center text-gray-600 mb-6">ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุนููุฉ ุงููุฎุฒูุฉ ูู Supabase</p>
            
            <div id="status" class="mb-6 p-4 bg-blue-50 rounded">
                <p class="text-blue-800">โณ ุฌุงุฑู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช...</p>
            </div>

            <div id="results" class="space-y-6"></div>
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://aydtrypogxbqmvbqerce.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF5ZHRyeXBvZ3hicW12YnFlcmNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MDY1ODMsImV4cCI6MjA3MTA4MjU4M30.J_bb8_J3eYW5XQ2D3oXLId8bHO4vYW5j9ZwdtUlZ0CA';

        async function checkRealData() {
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            try {
                // 1. ูุญุต ุงููุฑูุน
                statusDiv.innerHTML = '<p class="text-blue-800">โณ ุฌุงุฑู ูุญุต ุฌุฏูู ุงููุฑูุน...</p>';
                const { data: branches, error: branchesError } = await supabase
                    .from('branches')
                    .select('*');

                // 2. ูุญุต ุงููุณุชุฎุฏููู
                statusDiv.innerHTML = '<p class="text-blue-800">โณ ุฌุงุฑู ูุญุต ุฌุฏูู ุงููุณุชุฎุฏููู...</p>';
                const { data: users, error: usersError } = await supabase
                    .from('users')
                    .select('*');

                // 3. ูุญุต ุญุณุงุจุงุช ุงููุตุงุฏูุฉ (Auth)
                statusDiv.innerHTML = '<p class="text-blue-800">โณ ุฌุงุฑู ูุญุต ูุธุงู ุงููุตุงุฏูุฉ...</p>';
                const { data: authData, error: authError } = await supabase.auth.getSession();

                // ุนุฑุถ ุงููุชุงุฆุฌ
                statusDiv.innerHTML = '<p class="text-green-800">โ ุชู ุงูุงุชุตุงู ุจูุฌุงุญ!</p>';

                let html = '';

                // ูุชุงุฆุฌ ุงููุฑูุน
                html += `
                    <div class="border-r-4 border-purple-500 bg-white p-6 rounded shadow">
                        <h2 class="text-xl font-bold mb-4 text-purple-800">๐ข ุงููุฑูุน ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</h2>
                `;

                if (branchesError) {
                    html += `<div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800">โ ุฎุทุฃ: ${branchesError.message}</p>
                        <p class="text-sm text-red-600 mt-2">ุงูุฌุฏูู ูุฏ ูุง ูููู ููุฌูุฏุงู ุฃู ูุง ุชูุฌุฏ ุตูุงุญูุงุช ูููุตูู</p>
                    </div>`;
                } else if (!branches || branches.length === 0) {
                    html += `<div class="bg-yellow-50 p-4 rounded">
                        <p class="text-yellow-800">โ๏ธ ุงูุฌุฏูู ููุฌูุฏ ููู ูุง ุชูุฌุฏ ุจูุงูุงุช ููู</p>
                        <p class="text-sm text-yellow-700 mt-2">ูุฌุจ ุชุดุบูู ููู SQL ูุฅุถุงูุฉ ุงููุฑูุน</p>
                    </div>`;
                } else {
                    html += `<div class="bg-green-50 p-4 rounded">
                        <p class="text-green-800 font-semibold">โ ุชู ุงูุนุซูุฑ ุนูู ${branches.length} ูุฑุน</p>
                        <ul class="mt-2 space-y-1 text-sm">`;
                    branches.forEach(b => {
                        html += `<li class="text-gray-700">โข ${b.name} (${b.id})</li>`;
                    });
                    html += `</ul></div>`;
                }

                html += `</div>`;

                // ูุชุงุฆุฌ ุงููุณุชุฎุฏููู
                html += `
                    <div class="border-r-4 border-orange-500 bg-white p-6 rounded shadow">
                        <h2 class="text-xl font-bold mb-4 text-orange-800">๐ฅ ุงููุณุชุฎุฏููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</h2>
                `;

                if (usersError) {
                    html += `<div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800">โ ุฎุทุฃ: ${usersError.message}</p>
                        <p class="text-sm text-red-600 mt-2">ุงูุฌุฏูู ูุฏ ูุง ูููู ููุฌูุฏุงู ุฃู ูุง ุชูุฌุฏ ุตูุงุญูุงุช ูููุตูู</p>
                    </div>`;
                } else if (!users || users.length === 0) {
                    html += `<div class="bg-yellow-50 p-4 rounded">
                        <p class="text-yellow-800 font-semibold">โ๏ธ ูุง ุชูุฌุฏ ุญุณุงุจุงุช ูุณุชุฎุฏููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช</p>
                        <div class="mt-4 p-3 bg-blue-50 rounded">
                            <p class="text-blue-800 font-semibold mb-2">๐ ููููุฉ ุฅูุดุงุก ุญุณุงุจุงุช ูุนููุฉ:</p>
                            <ol class="text-sm text-blue-700 space-y-2 list-decimal list-inside">
                                <li>ุงุฐูุจ ุฅูู Supabase Dashboard</li>
                                <li>ุงูุชุญ ูุณู Authentication</li>
                                <li>ุงุถุบุท "Add User"</li>
                                <li>ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ</li>
                                <li>ุซู ุฃุถู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ุฌุฏูู users</li>
                            </ol>
                        </div>
                    </div>`;
                } else {
                    html += `<div class="bg-green-50 p-4 rounded">
                        <p class="text-green-800 font-semibold">โ ุชู ุงูุนุซูุฑ ุนูู ${users.length} ูุณุชุฎุฏู</p>
                        <ul class="mt-2 space-y-1 text-sm">`;
                    users.forEach(u => {
                        const roleIcon = u.role === 'admin' ? '๐' : '๐ข';
                        html += `<li class="text-gray-700">${roleIcon} ${u.email} - ${u.role}</li>`;
                    });
                    html += `</ul></div>`;
                }

                html += `</div>`;

                // ูุชุงุฆุฌ ุงููุตุงุฏูุฉ
                html += `
                    <div class="border-r-4 border-blue-500 bg-white p-6 rounded shadow">
                        <h2 class="text-xl font-bold mb-4 text-blue-800">๐ ุญุงูุฉ ุงููุตุงุฏูุฉ (Auth)</h2>
                `;

                if (authError) {
                    html += `<div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800">โ ุฎุทุฃ ูู ุงููุตุงุฏูุฉ: ${authError.message}</p>
                    </div>`;
                } else if (!authData || !authData.session) {
                    html += `<div class="bg-gray-50 p-4 rounded">
                        <p class="text-gray-800">โน๏ธ ูุง ุชูุฌุฏ ุฌูุณุฉ ูุดุทุฉ ุญุงููุงู</p>
                        <p class="text-sm text-gray-600 mt-2">ูู ูุชู ุชุณุฌูู ุฏุฎูู ุฃู ูุณุชุฎุฏู ูู ูุฐู ุงูุตูุญุฉ</p>
                    </div>`;
                } else {
                    html += `<div class="bg-green-50 p-4 rounded">
                        <p class="text-green-800">โ ููุฌุฏ ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู</p>
                        <p class="text-sm text-gray-700 mt-2">${authData.session.user.email}</p>
                    </div>`;
                }

                html += `</div>`;

                // ุงูุฎูุงุตุฉ
                html += `
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-lg shadow">
                        <h2 class="text-xl font-bold mb-4 text-gray-800">๐ ุงูุฎูุงุตุฉ</h2>
                        <div class="space-y-2 text-sm">
                            <p class="font-semibold text-gray-700">ุงูุญูุงุฆู ุงููููุฉ:</p>
                            <ul class="space-y-1 text-gray-600 mr-4">
                                <li>โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ ูุชุนูู</li>
                                <li>${branches && branches.length > 0 ? 'โ' : 'โ๏ธ'} ุฌุฏูู ุงููุฑูุน: ${branches ? branches.length : 0} ุณุฌู</li>
                                <li>${users && users.length > 0 ? 'โ' : 'โ๏ธ'} ุฌุฏูู ุงููุณุชุฎุฏููู: ${users ? users.length : 0} ุณุฌู</li>
                                <li>๐ ูููุงุช ุงููุฑูุฑ: <strong>ูุดูุฑุฉ ูู Supabase Auth ููุง ูููู ูุฑุงุกุชูุง</strong></li>
                            </ul>
                            <div class="mt-4 p-3 bg-yellow-100 border border-yellow-300 rounded">
                                <p class="text-yellow-900 font-semibold">โ๏ธ ุชูุจูู ููู:</p>
                                <p class="text-yellow-800 text-xs mt-1">
                                    ูููุงุช ุงููุฑูุฑ ุงูุญููููุฉ ูุง ูููู ุงููุตูู ุฅูููุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฃุณุจุงุจ ุฃูููุฉ.
                                    ูู ูุฎุฒูุฉ ุจุดูู ูุดูุฑ ูู ูุธุงู Supabase Auth ููุง ูููู ูู ุชุดููุฑูุง.
                                    ูุฐุง ูู ุงููุนูุงุฑ ุงูุฃููู ุงูุตุญูุญ ูุญูุงูุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู.
                                </p>
                            </div>
                        </div>
                    </div>
                `;

                resultsDiv.innerHTML = html;

            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="bg-red-50 p-4 rounded">
                        <p class="text-red-800 font-bold">โ ุฎุทุฃ ูู ุงูุงุชุตุงู</p>
                        <p class="text-red-700 text-sm mt-2">${error.message}</p>
                    </div>
                `;
                console.error('ุฎุทุฃ:', error);
            }
        }

        window.addEventListener('load', checkRealData);
    </script>
</body>
</html>
