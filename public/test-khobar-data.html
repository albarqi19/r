<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./assets/js/supabase-service.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-900">Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Ø­Ø§Ù„Ø© Ø§ØªØµØ§Ù„ Supabase</h2>
            <div id="connectionStatus" class="text-gray-600">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...</div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©</h2>
            <div id="branchData" class="text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">ØªÙØ§ØµÙŠÙ„ ØªÙ‚Ù†ÙŠØ©</h2>
            <div id="technicalDetails" class="text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„...</div>
        </div>

        <!-- Navigation -->
        <div class="text-center mt-8">
            <a href="./home.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors inline-flex items-center gap-2">
                <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
        </div>
    </div>

    <script>
        async function testKhobarData() {
            console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±...');
            
            // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§ØªØµØ§Ù„ Supabase
            const connectionDiv = document.getElementById('connectionStatus');
            const dataDiv = document.getElementById('branchData');
            const detailsDiv = document.getElementById('technicalDetails');
            
            try {
                connectionDiv.innerHTML = '<div class="text-yellow-600">â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø®Ø¯Ù…Ø© Supabase...</div>';
                
                // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø®Ø¯Ù…Ø© Supabase
                let attempts = 0;
                while (!window.supabaseService && attempts < 50) {
                    console.log(`Ù…Ø­Ø§ÙˆÙ„Ø© ${attempts + 1}: Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ supabaseService...`);
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.supabaseService) {
                    connectionDiv.innerHTML = '<div class="text-red-600">âŒ Ø®Ø¯Ù…Ø© Supabase ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù</div>';
                    detailsDiv.innerHTML = '<div class="bg-red-50 p-4 rounded-lg">Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ supabase-service.js</div>';
                    return;
                }
                
                connectionDiv.innerHTML = '<div class="text-green-600">âœ… Ø®Ø¯Ù…Ø© Supabase Ù…ØªÙˆÙØ±Ø©</div>';
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ supabaseService:', typeof window.supabaseService);
                
                // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© getBranch
                if (!window.supabaseService.getBranch) {
                    connectionDiv.innerHTML += '<div class="text-red-600 mt-2">âŒ Ø¯Ø§Ù„Ø© getBranch ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>';
                    detailsDiv.innerHTML = '<div class="bg-red-50 p-4 rounded-lg">Ø®Ø·Ø£: getBranch function not found</div>';
                    return;
                }
                
                connectionDiv.innerHTML += '<div class="text-green-600 mt-2">âœ… Ø¯Ø§Ù„Ø© getBranch Ù…ØªÙˆÙØ±Ø©</div>';
                
                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±
                dataDiv.innerHTML = '<div class="text-yellow-600">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±...</div>';
                console.log('ğŸ” Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±Ø¹ khobar...');
                
                const result = await window.supabaseService.getBranch('khobar');
                console.log('ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø©:', result);
                
                if (result.success && result.data) {
                    dataDiv.innerHTML = `
                        <div class="text-green-600 mb-4">âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold mb-2">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹:</h3>
                            <ul class="space-y-2">
                                <li><strong>Ø§Ù„Ù…Ø¹Ø±Ù:</strong> ${result.data.branch_id || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                                <li><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${result.data.branch_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                                <li><strong>Twitter:</strong> ${result.data.twitter || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                                <li><strong>WhatsApp:</strong> ${result.data.whatsapp || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                                <li><strong>Instagram:</strong> ${result.data.instagram || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                                <li><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${result.data.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                                <li><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${result.data.updated_at || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</li>
                            </ul>
                        </div>
                    `;
                    
                    detailsDiv.innerHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold mb-2">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…:</h3>
                            <pre class="text-xs overflow-x-auto bg-gray-800 text-green-400 p-3 rounded whitespace-pre-wrap">${JSON.stringify(result.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    dataDiv.innerHTML = `
                        <div class="text-red-600 mb-4">âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                        <div class="text-gray-600 mt-2">Ø§Ù„Ø³Ø¨Ø¨: ${result.error || result.message || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                    `;
                    
                    detailsDiv.innerHTML = `
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h3 class="font-semibold mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:</h3>
                            <pre class="text-xs overflow-x-auto bg-red-100 text-red-800 p-3 rounded whitespace-pre-wrap">${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                connectionDiv.innerHTML = '<div class="text-red-600">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
                dataDiv.innerHTML = `<div class="text-red-600">Ø®Ø·Ø£: ${error.message}</div>`;
                detailsDiv.innerHTML = `
                    <div class="bg-red-50 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:</h3>
                        <pre class="text-xs overflow-x-auto bg-red-100 text-red-800 p-3 rounded whitespace-pre-wrap">${error.stack}</pre>
                    </div>
                `;
            }
        }
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ DOM Ø£ÙˆÙ„Ø§Ù‹
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', testKhobarData);
        } else {
            // DOM already loaded
            testKhobarData();
        }
        
        // Fallback: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ† ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­ÙˆØ§Ù„
        setTimeout(testKhobarData, 2000);
    </script>
</body>
</html>
