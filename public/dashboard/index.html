<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - ØªØ­ÙÙŠØ¸ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#494776',
                        secondary: '#4F9DA6',
                        custom: '#323266',
                        accent: '#7DCCE5'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <style>
        .dashboard-card {
            transition: all 0.3s ease;
            border: 1px solid rgba(73, 71, 118, 0.1);
        }
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(73, 71, 118, 0.1);
            border-color: rgba(73, 71, 118, 0.2);
        }
        .input-field {
            transition: all 0.3s ease;
        }
        .input-field:focus {
            border-color: #494776;
            box-shadow: 0 0 0 3px rgba(73, 71, 118, 0.1);
        }
        .status-pending {
            background: #f59e0b;
        }
        .status-approved {
            background: #10b981;
        }
        .status-rejected {
            background: #ef4444;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <nav class="bg-primary shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo & Title -->
                <div class="flex items-center gap-4">
                    <img src="../Logo.png" alt="ØªØ­ÙÙŠØ¸ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©" class="w-12 h-12 object-contain">
                    <div>
                        <h1 class="text-white text-xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
                        <p class="text-white/80 text-sm" id="branchTitle">ÙØ±Ø¹ ØºØ±Ø¨ Ø§Ù„Ø¯Ù…Ø§Ù…</p>
                    </div>
                </div>
                
                <!-- User Actions -->
                <div class="flex items-center gap-3">
                    <button id="checkSessionBtn" class="bg-yellow-500/80 hover:bg-yellow-500 text-white px-3 py-2 rounded-lg text-xs transition-all">
                        <i class="fas fa-user-check ml-1"></i>
                        ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
                    </button>
                    <button id="previewBtn" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm transition-all">
                        <i class="fas fa-eye ml-2"></i>
                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙØ­Ø©
                    </button>
                    <button id="logoutBtn" class="bg-red-500/80 hover:bg-red-500 text-white px-4 py-2 rounded-lg text-sm transition-all">
                        <i class="fas fa-sign-out-alt ml-2"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        
        <!-- Status Alert -->
        <div id="statusAlert" class="mb-6 p-4 rounded-xl border-r-4 bg-blue-50 border-primary hidden">
            <div class="flex items-center">
                <i class="fas fa-info-circle text-primary ml-3"></i>
                <div>
                    <h3 class="text-primary font-semibold">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</h3>
                    <p class="text-gray-600 text-sm mt-1" id="statusMessage">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø©</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Social Media Links -->
            <div class="lg:col-span-2">
                <div class="dashboard-card bg-white rounded-2xl p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-primary flex items-center gap-2">
                            <i class="fas fa-share-alt"></i>
                            Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
                        </h2>
                        <span class="status-approved text-white text-xs px-3 py-1 rounded-full">
                            Ù…Ø¹ØªÙ…Ø¯
                        </span>
                    </div>
                    
                    <form id="socialLinksForm" class="space-y-4">
                        
                        <!-- Twitter/X -->
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2 flex items-center gap-2">
                                <i class="fab fa-twitter text-blue-500"></i>
                                Ø±Ø§Ø¨Ø· ØªÙˆÙŠØªØ± (X)
                            </label>
                            <input type="url" id="twitterUrl" 
                                   class="input-field w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none"
                                   placeholder="https://x.com/username"
                                   value="https://x.com/Org2Qer">
                        </div>
                        
                        <!-- Instagram -->
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2 flex items-center gap-2">
                                <i class="fab fa-instagram text-pink-500"></i>
                                Ø±Ø§Ø¨Ø· Ø¥Ù†Ø³ØªØºØ±Ø§Ù…
                            </label>
                            <input type="url" id="instagramUrl"
                                   class="input-field w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none"
                                   placeholder="https://instagram.com/username"
                                   value="https://www.instagram.com/org2qer/">
                        </div>
                        
                        <!-- WhatsApp -->
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2 flex items-center gap-2">
                                <i class="fab fa-whatsapp text-green-500"></i>
                                Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨
                            </label>
                            <input type="tel" id="whatsappNumber"
                                   class="input-field w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none"
                                   placeholder="966XXXXXXXXX"
                                   value="966138360356">
                            <p class="text-gray-500 text-xs mt-1">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© +</p>
                        </div>
                        
                        <!-- Location -->
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2 flex items-center gap-2">
                                <i class="fas fa-map-marker-alt text-red-500"></i>
                                Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
                            </label>
                            <input type="url" id="locationUrl"
                                   class="input-field w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none"
                                   placeholder="https://maps.google.com/..."
                                   value="https://maps.app.goo.gl/cFQHa1b2y3uoDbGy9">
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="pt-4">
                            <button type="submit" 
                                    class="btn-primary w-full flex items-center justify-center gap-2 py-3 text-base">
                                <i class="fas fa-save"></i>
                                <span>Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span>
                                <span id="saveSpinner" class="hidden">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                            </button>
                        </div>
                        
                    </form>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="space-y-6">
                
                <!-- Quick Stats -->
                <div class="dashboard-card bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold text-primary mb-4 flex items-center gap-2">
                        <i class="fas fa-chart-simple"></i>
                        Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center py-2">
                            <span class="text-gray-600 text-sm">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</span>
                            <span class="text-primary font-semibold text-sm">Ù…Ù†Ø° ÙŠÙˆÙ…ÙŠÙ†</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-gray-600 text-sm">Ø­Ø§Ù„Ø© Ø§Ù„ØµÙØ­Ø©</span>
                            <span class="status-approved text-white text-xs px-2 py-1 rounded-full">Ù†Ø´Ø·Ø©</span>
                        </div>
                        <div class="flex justify-between items-center py-2">
                            <span class="text-gray-600 text-sm">Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</span>
                            <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded-full">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="dashboard-card bg-white rounded-2xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold text-primary mb-4 flex items-center gap-2">
                        <i class="fas fa-bolt"></i>
                        Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
                    </h3>
                    
                    <div class="space-y-3">
                        <button class="w-full text-right px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors flex items-center gap-3">
                            <i class="fas fa-eye text-secondary"></i>
                            <span class="text-gray-700">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙØ­Ø©</span>
                        </button>
                        
                        <button class="w-full text-right px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors flex items-center gap-3">
                            <i class="fas fa-history text-secondary"></i>
                            <span class="text-gray-700">Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</span>
                        </button>
                        
                        <button class="w-full text-right px-4 py-3 bg-gray-50 hover:bg-gray-100 rounded-xl transition-colors flex items-center gap-3">
                            <i class="fas fa-question-circle text-secondary"></i>
                            <span class="text-gray-700">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</span>
                        </button>
                    </div>
                </div>
                
                <!-- Support -->
                <div class="dashboard-card bg-secondary rounded-2xl p-6 shadow-lg text-white">
                    <h3 class="text-lg font-bold mb-3 flex items-center gap-2">
                        <i class="fas fa-headset"></i>
                        Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ
                    </h3>
                    <p class="text-white/90 text-sm mb-4">
                        Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù…ØªØ§Ø­ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ
                    </p>
                    <button class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm transition-all w-full">
                        <i class="fas fa-comments ml-2"></i>
                        ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§
                    </button>
                </div>
                
            </div>
            
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Fallback Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ supabaseService
        console.log('ğŸ”§ Dashboard: Fallback check for supabaseService...');
        if (!window.supabaseService) {
            console.log('âš ï¸ Dashboard: Ø¥Ù†Ø´Ø§Ø¡ supabaseService fallback');
            window.supabaseService = {
                checkSession: function() {
                    console.log('ğŸ” Fallback checkSession');
                    return { hasSession: false, user: null };
                },
                createUpdateRequest: function() {
                    console.log('âš ï¸ Fallback createUpdateRequest - Ø³ØªÙƒÙˆÙ† Ù…ØªÙˆÙØ±Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹');
                    return Promise.resolve({ success: false, error: 'Service not ready' });
                }
            };
        }
    </script>
    <script src="../assets/js/supabase-service.js"></script>
    <script src="../assets/js/app.js"></script>
    <script>
        class DashboardManager {
            constructor() {
                this.currentBranch = this.getBranchFromPath();
                console.log('ğŸ¯ DashboardManager constructor - Supabase Service Ù…ØªÙˆÙØ±ØŸ', !!window.supabaseService);
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±Ø§Ù‹
                this.init();
            }
            
            getBranchFromPath() {
                // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬Ù‡ Ù…Ù† localStorage Ø£Ùˆ URL parameters
                return localStorage.getItem('currentBranch') || 'garb-dammam';
            }
            
            async init() {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                if (!this.checkUserSession()) {
                    return;
                }
                
                this.setupEventListeners();
                await this.loadBranchData();
                this.updateUI();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©
                this.checkPendingRequests();
            }

            checkUserSession() {
                const userSession = localStorage.getItem('userSession');
                if (!userSession) {
                    alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                    window.location.href = '../auth/login.html';
                    return false;
                }

                const user = JSON.parse(userSession);
                if (user.role !== 'branch_manager' && user.role !== 'admin') {
                    alert('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©');
                    window.location.href = '../auth/login.html';
                    return false;
                }

                // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„ÙØ±Ø¹ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¯ÙŠØ± ÙØ±Ø¹
                if (user.role === 'branch_manager' && user.branchId) {
                    localStorage.setItem('currentBranch', user.branchId);
                    this.currentBranch = user.branchId;
                }

                return true;
            }

            // ÙˆØ¸ÙŠÙØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§
            checkSessionStatus() {
                const userSession = localStorage.getItem('userSession');
                const currentBranch = localStorage.getItem('currentBranch');
                const userToken = localStorage.getItem('userToken');

                const sessionInfo = {
                    userSession: userSession ? JSON.parse(userSession) : null,
                    currentBranch: currentBranch,
                    userToken: userToken
                };

                console.log('=== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ===', sessionInfo);
                
                // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const sessionText = userSession ? 
                    `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${JSON.parse(userSession).username}\nØ§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${JSON.parse(userSession).role}\nØ§Ù„ÙØ±Ø¹: ${currentBranch || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}` :
                    'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø³ØªØ®Ø¯Ù…';
                    
                alert(`Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©:\n${sessionText}`);
            }
            
            setupEventListeners() {
                // Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('socialLinksForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveSocialLinks();
                });

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
                document.getElementById('checkSessionBtn').addEventListener('click', () => {
                    this.checkSessionStatus();
                });
                
                // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙØ­Ø©
                document.getElementById('previewBtn').addEventListener('click', () => {
                    window.open(`../branches/${this.currentBranch}/`, '_blank');
                });
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                        localStorage.removeItem('currentBranch');
                        localStorage.removeItem('userToken');
                        window.location.href = '../auth/login.html';
                    }
                });
            }
            
            async loadBranchData() {
                console.log('ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹:', this.currentBranch);
                
                try {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
                    if (window.supabaseService && typeof window.supabaseService.getAllBranches === 'function') {
                        console.log('ğŸ”¥ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±ÙˆØ¹ Ù…Ù† Supabase...');
                        const result = await window.supabaseService.getAllBranches();
                        
                        if (result.success && result.data) {
                            console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase:', Object.keys(result.data).length, 'ÙØ±Ø¹');
                            
                            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
                            const branchData = result.data[this.currentBranch];
                            if (branchData) {
                                console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹:', branchData.name);
                                this.branchData = branchData;
                                return;
                            } else {
                                console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹:', this.currentBranch);
                                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙˆÙ„ ÙØ±Ø¹ Ù…ØªØ§Ø­ ÙƒØ¨Ø¯ÙŠÙ„
                                const firstBranch = Object.keys(result.data)[0];
                                if (firstBranch) {
                                    console.log('ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£ÙˆÙ„ ÙƒØ¨Ø¯ÙŠÙ„:', firstBranch);
                                    this.currentBranch = firstBranch;
                                    this.branchData = result.data[firstBranch];
                                    return;
                                }
                                throw new Error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ±ÙˆØ¹');
                            }
                        } else {
                            console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase:', result.error);
                            throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + result.error);
                        }
                    } else {
                        console.error('âŒ Supabase Service ØºÙŠØ± Ù…ØªÙˆÙØ± Ø£Ùˆ getAllBranches ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                        console.log('ğŸ” Ø§Ù„Ù…ØªÙˆÙØ±:', window.supabaseService ? Object.keys(window.supabaseService) : 'Ù„Ø§ Ø´ÙŠØ¡');
                        throw new Error('Supabase Service ØºÙŠØ± Ù…ØªÙˆÙØ±');
                    }
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¹:', error);
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    document.body.innerHTML = `
                        <div class="min-h-screen bg-gray-100 flex items-center justify-center">
                            <div class="bg-white p-8 rounded-lg shadow-md max-w-md w-full text-center">
                                <div class="text-red-500 mb-4">
                                    <svg class="w-16 h-16 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                                <p class="text-gray-600 mb-4">${error.message}</p>
                                <button onclick="location.reload()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                                </button>
                            </div>
                        </div>
                    `;
                    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                    this.branchData = {
                        id: this.currentBranch,
                        name: 'ÙØ±Ø¹ ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        twitter: '',
                        whatsapp: '',
                        instagram: '',
                        location: ''
                    };
                }
            }
            
            updateUI() {
                if (!this.branchData) return;
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹
                document.getElementById('branchTitle').textContent = `ÙØ±Ø¹ ${this.branchData.name}`;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('twitterUrl').value = this.branchData.twitter || '';
                document.getElementById('instagramUrl').value = this.branchData.instagram || '';
                document.getElementById('whatsappNumber').value = this.branchData.whatsapp || '';
                document.getElementById('locationUrl').value = this.branchData.location || '';
            }
            
            // ÙˆØ¸ÙŠÙØ© Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Firebase
            async waitForFirebase(maxWaitTime = 3000) {
                console.log('ğŸ” waitForFirebase: Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ...');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ÙÙˆØ±ÙŠ
                if (window.supabaseService) {
                    if (typeof window.supabaseService.createUpdateRequest === 'function') {
                        console.log('âœ… Supabase Service Ø¬Ø§Ù‡Ø² Ù…Ø³Ø¨Ù‚Ø§Ù‹ - createUpdateRequest Ù…ØªÙˆÙØ±');
                        return true;
                    } else if (window.supabaseService.checkSession) {
                        console.log('âš¡ Supabase Service Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù… ØªØ­Ø¯Ø« Ø¨Ø¹Ø¯ - Ø³Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©');
                        return true;
                    }
                }
                
                console.log('ğŸ” window.supabaseService Ù…ÙˆØ¬ÙˆØ¯ØŸ', !!window.supabaseService);
                if (window.supabaseService) {
                    console.log('ğŸ” createUpdateRequest Ù…ØªÙˆÙØ±ØŸ', typeof window.supabaseService.createUpdateRequest);
                }
                
                return new Promise((resolve) => {
                    const startTime = Date.now();
                    
                    const checkFirebase = () => {
                        if (window.supabaseService) {
                            if (typeof window.supabaseService.createUpdateRequest === 'function') {
                                console.log('âœ… Supabase Service Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… - createUpdateRequest Ù…ØªÙˆÙØ±');
                                resolve(true);
                                return;
                            } else {
                                // Ø¥Ø°Ø§ ÙƒØ§Ù† Firebase Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù… ØªØ­Ø¯Ø« Ø¨Ø¹Ø¯
                                if (Date.now() - startTime > 1000) {
                                    console.log('âš¡ Firebase Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù… ØªØ­Ø¯Ø« - Ø³Ù†ØªØ§Ø¨Ø¹');
                                    resolve(true);
                                    return;
                                }
                            }
                        }
                        
                        if (Date.now() - startTime > maxWaitTime) {
                            console.error('âŒ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Supabase Service');
                            resolve(false);
                            return;
                        }
                        
                        setTimeout(checkFirebase, 100);
                    };
                    
                    checkFirebase();
                });
            }

            async saveSocialLinks() {
                // Debug: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
                const userSession = localStorage.getItem('userSession');
                console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©:', userSession ? 'Ù…ÙˆØ¬ÙˆØ¯Ø©' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                if (userSession) {
                    const user = JSON.parse(userSession);
                    console.log('ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', user);
                }

                const submitBtn = document.querySelector('#socialLinksForm button[type="submit"]');
                const spinner = document.getElementById('saveSpinner');
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                submitBtn.disabled = true;
                spinner.classList.remove('hidden');
                
                try {
                    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    const formData = {
                        twitter: document.getElementById('twitterUrl').value,
                        instagram: document.getElementById('instagramUrl').value,
                        whatsapp: document.getElementById('whatsappNumber').value,
                        location: document.getElementById('locationUrl').value,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase Service
                    console.log('â³ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© Firebase...');
                    const firebaseReady = await this.waitForFirebase();
                    
                    if (firebaseReady && window.supabaseService) {
                        let result = null;
                        try {
                            console.log('ğŸš€ dashboard: Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø­ÙØ¸ Firebase...');
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ù„Ø© createUpdateRequest
                            if (typeof window.supabaseService.createUpdateRequest === 'function') {
                                console.log('âœ… createUpdateRequest Ù…ØªÙˆÙØ±Ø© - Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
                                result = await window.supabaseService.createUpdateRequest(
                                    this.currentBranch, 
                                    formData
                                );
                            } else {
                                console.warn('âš ï¸ createUpdateRequest ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© - Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©');
                                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
                                result = await window.supabaseService.createUpdateRequest(
                                    this.currentBranch, 
                                    formData
                                );
                            }
                            
                            console.log('ğŸ“‹ dashboard: Ù†ØªÙŠØ¬Ø© createUpdateRequest:', result);
                            
                            if (result.success) {
                                console.log('âœ… dashboard: Ù†Ø¬Ø­ Firebase - Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±');
                                this.showNotification(
                                    'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©! Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.',
                                    'success'
                                );
                                
                                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØµÙØ­Ø©
                                this.updateStatusToPending();
                                
                                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¯Ø«
                                window.supabaseService.logEvent('update_request_created', {
                                    branch_id: this.currentBranch,
                                    request_type: 'social_links'
                                });
                                
                                return;
                            } else {
                                console.error('âŒ dashboard: ÙØ´Ù„ Firebase - result.success = false');
                                console.error('âŒ dashboard: Ø®Ø·Ø£ Firebase:', result.error);
                                // Ø³Ù†Ø°Ù‡Ø¨ Ù„Ù„Ù€ fallback
                            }
                        } catch (firebaseError) {
                            console.error('âŒ dashboard: Ø§Ø³ØªØ«Ù†Ø§Ø¡ Firebase:', firebaseError);
                            console.log('ğŸ”„ dashboard: Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
                        }
                    } else {
                        console.warn('âš ï¸ dashboard: supabaseService ØºÙŠØ± Ù…ØªÙˆÙØ±');
                    }
                    
                    // Fallback Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    this.showNotification(
                        'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.',
                        'success'
                    );
                    
                    // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
                    const localData = JSON.parse(localStorage.getItem('branchUpdates') || '{}');
                    localData[this.currentBranch] = formData;
                    localStorage.setItem('branchUpdates', JSON.stringify(localData));
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', error);
                    this.showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                } finally {
                    // Ø¥Ø®ÙØ§Ø¡ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    submitBtn.disabled = false;
                    spinner.classList.add('hidden');
                }
            }
            
            updateStatusToPending() {
                const statusElement = document.querySelector('.status-approved, .status-pending');
                if (statusElement) {
                    statusElement.className = 'status-pending text-white text-xs px-3 py-1 rounded-full';
                    statusElement.textContent = 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                }
                
                // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙÙŠ localStorage
                const pendingStatus = {
                    branchId: this.currentBranch,
                    status: 'pending',
                    timestamp: Date.now(),
                    message: 'ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'
                };
                
                let pendingRequests = JSON.parse(localStorage.getItem('pendingRequests') || '{}');
                pendingRequests[this.currentBranch] = pendingStatus;
                localStorage.setItem('pendingRequests', JSON.stringify(pendingRequests));
                
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±:', pendingStatus);
            }
            
            checkPendingRequests() {
                const pendingRequests = JSON.parse(localStorage.getItem('pendingRequests') || '{}');
                const currentPending = pendingRequests[this.currentBranch];
                
                if (currentPending && currentPending.status === 'pending') {
                    console.log('ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚:', currentPending);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ Ø­Ø¯ÙŠØ« (Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©)
                    const hoursSinceRequest = (Date.now() - currentPending.timestamp) / (1000 * 60 * 60);
                    if (hoursSinceRequest < 24) {
                        console.log('â³ ØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©');
                        
                        // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                        const statusElement = document.querySelector('.status-approved, .status-pending');
                        if (statusElement) {
                            statusElement.className = 'status-pending text-white text-xs px-3 py-1 rounded-full';
                            statusElement.textContent = 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                        }
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡
                        this.showNotification('ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'info');
                    } else {
                        console.log('ğŸ—‘ï¸ Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø¯ÙŠÙ… - Ø­Ø°Ù Ù…Ù† localStorage');
                        delete pendingRequests[this.currentBranch];
                        localStorage.setItem('pendingRequests', JSON.stringify(pendingRequests));
                    }
                }
            }
            
            showNotification(message, type = 'info') {
                if (window.utils) {
                    if (type === 'success') {
                        window.utils.showSuccess(message);
                    } else {
                        window.utils.showError(message);
                    }
                } else {
                    alert(message);
                }
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', async () => {
            console.log('ğŸ”„ Page loaded - Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Dashboard...');
            console.log('ğŸ” Ø¬Ù…ÙŠØ¹ scripts ÙÙŠ head:', Array.from(document.querySelectorAll('script')).map(s => s.src));
            console.log('ğŸ” Ù‡Ù„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Firebase ÙÙŠ windowØŸ', !!window.firebase);
            console.log('ğŸ” Ù‡Ù„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ supabaseServiceØŸ', !!window.supabaseService);
            
            // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase Service
            let attempts = 0;
            const maxAttempts = 50; // 5 Ø«ÙˆØ§Ù†ÙŠ
            
            while (attempts < maxAttempts) {
                if (window.supabaseService) {
                    console.log('âœ… window.supabaseService Ù…ÙˆØ¬ÙˆØ¯ - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯ÙˆØ§Ù„...');
                    console.log('ğŸ” createUpdateRequest Ù…ØªÙˆÙØ±ØŸ', typeof window.supabaseService.createUpdateRequest);
                    console.log('ğŸ” getAllBranches Ù…ØªÙˆÙØ±ØŸ', typeof window.supabaseService.getAllBranches);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ø¯Ø§Ù„Ø© Firebase Ø£Ùˆ Ø¥Ø°Ø§ ÙƒØ§Ù† Firebase Ø¬Ø§Ù‡Ø²
                    if (window.supabaseService.createUpdateRequest || 
                        window.supabaseService.getAllBranches || 
                        (window.supabaseService.checkSession && attempts > 10)) {
                        console.log('âœ… Supabase Service Ù…ØªÙˆÙØ± - Ø¥Ù†Ø´Ø§Ø¡ Dashboard Manager');
                        window.dashboardManager = new DashboardManager();
                        return;
                    }
                } else {
                    console.log(`â³ window.supabaseService ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ - Ù…Ø­Ø§ÙˆÙ„Ø© ${attempts + 1}/${maxAttempts}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            
            console.error('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Supabase Service - Ø¥Ù†Ø´Ø§Ø¡ Dashboard Ø¨Ø¯ÙˆÙ† Firebase');
            window.dashboardManager = new DashboardManager();
        });
    </script>
</body>
</html>
