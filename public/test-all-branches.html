<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./assets/js/supabase-service.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'IBM Plex Sans Arabic', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-900">ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <div id="systemStatus" class="text-gray-600">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Ø§Ø®ØªØ¨Ø§Ø± ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø± (khobar)</h2>
            <div id="khobarTest" class="text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
            <div id="allBranches" class="text-gray-600">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙˆØ¹...</div>
        </div>

        <!-- Navigation -->
        <div class="text-center mt-8">
            <a href="./home.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors inline-flex items-center gap-2 mx-2">
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
            <a href="./branch-template.html?branch=khobar" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors inline-flex items-center gap-2 mx-2">
                Ø§Ø®ØªØ¨Ø§Ø± ØµÙØ­Ø© Ø§Ù„Ø®Ø¨Ø±
            </a>
        </div>
    </div>

    <script>
        async function testAllBranches() {
            console.log('ğŸ”„ Ø¨Ø¯Ø¡ ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹...');
            
            const systemDiv = document.getElementById('systemStatus');
            const khobarDiv = document.getElementById('khobarTest');
            const allBranchesDiv = document.getElementById('allBranches');
            
            try {
                // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
                systemDiv.innerHTML = '<div class="text-yellow-600">â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø®Ø¯Ù…Ø© Supabase...</div>';
                
                let attempts = 0;
                while (!window.supabaseService && attempts < 50) {
                    console.log(`Ù…Ø­Ø§ÙˆÙ„Ø© ${attempts + 1}: Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ supabaseService...`);
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (!window.supabaseService) {
                    systemDiv.innerHTML = '<div class="text-red-600">âŒ Ø®Ø¯Ù…Ø© Supabase ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>';
                    return;
                }
                
                systemDiv.innerHTML = '<div class="text-green-600">âœ… Ø®Ø¯Ù…Ø© Supabase Ù…ØªÙˆÙØ±Ø©</div>';
                
                // ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©
                const availableFunctions = Object.keys(window.supabaseService).filter(key => typeof window.supabaseService[key] === 'function');
                systemDiv.innerHTML += `<div class="text-blue-600 mt-2">ğŸ“‹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©: ${availableFunctions.join(', ')}</div>`;
                
                // Ø§Ø®ØªØ¨Ø§Ø± ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±
                khobarDiv.innerHTML = '<div class="text-yellow-600">â³ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±...</div>';
                
                if (window.supabaseService.getBranch) {
                    const khobarResult = await window.supabaseService.getBranch('khobar');
                    console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø®Ø¨Ø±:', khobarResult);
                    
                    if (khobarResult.success && khobarResult.data) {
                        khobarDiv.innerHTML = `
                            <div class="text-green-600 mb-2">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±</div>
                            <div class="bg-green-50 p-3 rounded">
                                <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${khobarResult.data.name || khobarResult.data.branch_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                                <strong>Ø§Ù„Ù…Ø¹Ø±Ù:</strong> ${khobarResult.data.id || khobarResult.data.branch_id || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                                <strong>Twitter:</strong> ${khobarResult.data.twitter || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                                <strong>WhatsApp:</strong> ${khobarResult.data.whatsapp || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                            </div>
                        `;
                    } else {
                        khobarDiv.innerHTML = `
                            <div class="text-red-600 mb-2">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙØ±Ø¹ Ø§Ù„Ø®Ø¨Ø±</div>
                            <div class="bg-red-50 p-3 rounded text-sm">
                                <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:</strong><br>
                                <pre>${JSON.stringify(khobarResult, null, 2)}</pre>
                            </div>
                        `;
                    }
                } else {
                    khobarDiv.innerHTML = '<div class="text-red-600">âŒ Ø¯Ø§Ù„Ø© getBranch ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>';
                }
                
                // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹
                allBranchesDiv.innerHTML = '<div class="text-yellow-600">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹...</div>';
                
                if (window.supabaseService.getAllBranches) {
                    const allBranchesResult = await window.supabaseService.getAllBranches();
                    console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹:', allBranchesResult);
                    
                    if (allBranchesResult.success && allBranchesResult.data) {
                        const branches = allBranchesResult.data;
                        let branchesHtml = `<div class="text-green-600 mb-4">âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${branches.length} ÙØ±Ø¹</div>`;
                        branchesHtml += '<div class="grid gap-4">';
                        
                        branches.forEach(branch => {
                            branchesHtml += `
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <div class="font-bold text-lg">${branch.name || branch.branch_name || 'Ø§Ø³Ù… ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    <div class="text-sm text-gray-600">Ø§Ù„Ù…Ø¹Ø±Ù: ${branch.id || branch.branch_id || 'Ù…Ø¹Ø±Ù ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    <div class="text-sm text-gray-600">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${branch.updated_at || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                                    <a href="./branch-template.html?branch=${branch.id || branch.branch_id}" 
                                       class="inline-block mt-2 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                       Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙØ­Ø©
                                    </a>
                                </div>
                            `;
                        });
                        
                        branchesHtml += '</div>';
                        allBranchesDiv.innerHTML = branchesHtml;
                    } else {
                        allBranchesDiv.innerHTML = `
                            <div class="text-red-600 mb-2">âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙˆØ¹</div>
                            <div class="bg-red-50 p-3 rounded text-sm">
                                <pre>${JSON.stringify(allBranchesResult, null, 2)}</pre>
                            </div>
                        `;
                    }
                } else {
                    allBranchesDiv.innerHTML = '<div class="text-red-600">âŒ Ø¯Ø§Ù„Ø© getAllBranches ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>';
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙØ­Øµ:', error);
                systemDiv.innerHTML = '<div class="text-red-600">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</div>';
                allBranchesDiv.innerHTML = `
                    <div class="text-red-600 mb-2">âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <div class="bg-red-50 p-3 rounded text-sm">
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', testAllBranches);
        } else {
            testAllBranches();
        }
    </script>
</body>
</html>
